export MYPATH=$SLEUTH_PATH/src
export VULN=CVE-2022-26981
export VULN_DIR=project/liblouis_project/liblouis
export VULN_TOOL=$VULN_DIR/liblouis
export TOOL=tools/lou_checktable
export SINGLETOOL=lou_checktable
export OBJECT=$MYPATH/$VULN_DIR
echo "================"
cd $OBJECT
make clean
git checkout -f 4d73c81
./autogen.sh
echo "========check version done========="
source $MYPATH'/evn/instrument.sh'
./configure --disable-shared
make > test.log
echo "========init make done========"
cd $MYPATH/vuln_tool
./run.sh $VULN > $MYPATH/$VULN_DIR/../$VULN/record.log
cd ../$VULN_TOOL
$SLEUTH_PATH/ddgAnalysis/build/tools/dataflow-cc -emit-llvm -DHAVE_CONFIG_H -I.  -fno-common -Wall -Wbad-function-cast -Wdate-time -Wdisabled-optimization -Wdouble-promotion -Wextra -Winit-self -Winline -Winvalid-pch -Wmissing-declarations -Wmissing-include-dirs -Wmissing-prototypes -Wnested-externs -Wnull-dereference -Wold-style-definition -Woverlength-strings -Wpacked -Wpointer-arith -Wshadow -Wstack-protector -Wstrict-overflow -Wstrict-prototypes -Wuninitialized -Wunknown-pragmas -Wvariadic-macros -Wvla -Wwrite-strings -Wformat=2 -DTABLESDIR=\""/usr/local/share"/liblouis/tables\" -I../gnulib -I../gnulib   -g -O0 -MT compileTranslationTable.o.bc -MD -MP -MF .deps/compileTranslationTable.Tpo -S -o compileTranslationTable.o.bc compileTranslationTable.c >> $MYPATH/$VULN_DIR/../$VULN/record.log
$SLEUTH_PATH/ddgAnalysis/build/tools/static-dua --ander compileTranslationTable.o.bc --out=$MYPATH/vulnInfo/target.json >> $MYPATH/$VULN_DIR/../$VULN/record.log
echo "========analysis done========="
cd $OBJECT
make clean
DDG_INSTR=1 AFL_LLVM_INSTRUMENT=classic make | grep "DDG - Instrumented" >> $MYPATH/$VULN_DIR/../$VULN/record.log
mkdir -p fuzz_$VULN/in
cp $TOOL 'fuzz_'$VULN'/'$SINGLETOOL'_cov'
cp ../$VULN/poc fuzz_$VULN/in/
echo "========netfuzz compiler done========"
make clean
source $MYPATH/evn/comp_instrument.sh
./configure --disable-shared
AFL_LLVM_INSTRUMENT=classic make > test.log
mkdir -p comp_fuzz_$VULN/in
cp $TOOL 'comp_fuzz_'$VULN'/'$SINGLETOOL'_cov'
cp ../$VULN/poc comp_fuzz_$VULN/in/
echo "========AFL++ compiler done========"

